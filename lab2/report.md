# Лабораторная работа №2

## Задание

Цель работы - на выделенном узле создать и сконфигурировать новый кластер БД Postgres, саму БД, табличные пространства и новую роль, а также произвести наполнение базы в соответствии с заданием. Отчёт по работе должен содержать все команды по настройке, скрипты, а также измененные строки конфигурационных файлов. Способ подключения к узлу из сети Интернет через helios: ssh -J sXXXXXX@helios.cs.ifmo.ru:2222 postgresY@pgZZZ Способ подключения к узлу из сети факультета: ssh postgresY@pgZZZ Номер выделенного узла pgZZZ, а также логин и пароль для подключения Вам выдаст преподаватель.

Обратите внимание, что домашняя директория пользователя /var/postgres/$LOGNAME

### Этап 1. Инициализация кластера БД

    Директория кластера: $HOME/unb63
    Кодировка: ANSI1251
    Локаль: английская
    Параметры инициализации задать через аргументы команды

### Этап 2. Конфигурация и запуск сервера БД

    Способ подключения: сокет TCP/IP, только localhost

    Номер порта: 9144

    Остальные способы подключений запретить.

    Способ аутентификации клиентов: по паролю в открытом виде

    Настроить следующие параметры сервера БД:
       - max_connections
       - shared_buffers
       - temp_buffers
       - work_mem
       - checkpoint_timeout
       - effective_cache_size
       - fsync
       - commit_delay

    Параметры должны быть подобраны в соответствии с аппаратной конфигурацией:

     - оперативная память 2ГБ
     - хранение на твердотельном накопителе (SSD)

    Директория WAL файлов: $HOME/uxc31

    Формат лог-файлов: .log

    Уровень сообщений лога: ERROR

    Дополнительно логировать: попытки подключения и завершение сессий

### Этап 3. Дополнительные табличные пространства и наполнение базы

    Создать новые табличные пространства для различных таблиц: $HOME/tym66, $HOME/fwb3, $HOME/raz87
    На основе template1 создать новую базу: illpinkexam
    Создать новую роль, предоставить необходимые права, разрешить подключение к базе.
    От имени новой роли (не администратора) произвести наполнение ВСЕХ созданных баз тестовыми наборами данных. ВСЕ табличные пространства должны использоваться по - назначению.
    Вывести список всех табличных пространств кластера и содержащиеся в них объекты.

### Вопросы для подготовки к защите

    Способы запуска и остановки сервера PosgreSQL, их отличия.
    Какие параметры локали сервера БД можно настроить? На что они влияют? Как и где их переопределить?
    Конфигурационные файлы сервера. Способы изменения и применения конфигурации.
    Что такое табличное пространство? Зачем нужны дополнительные табличные пространства?
    Зачем нужны template0 и template1?
    OLTP vs OLAP.
    Роли и права доступа.

## Выполнение:

создание кластера:

```bash
initdb --locale=ru_RU.CP1251 -D unb63/ --username=postgres1 -E WIN1251D
```

запуск: 

```bash
pg_ctl -D /var/db/postgres1/unb63/ -l logfile start
```

измененные параметры в `postgresql.conf`:

```
listen_addresses = 'localhost'
port = 9144
max_connections = 101

shared_buffers = 128MB 
temp_buffers = 16MB
work_mem = 8MB
checkpoint_timeout = 5min
effective_cache_size = 1GB # 1/2 всего объема
fsync = on # супер-надежный и быстрый ssd
commit_delay = 1 # не много не мало

log_min_messages = error

```

